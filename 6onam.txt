const axios = require("axios");
const fs = require("fs");
const FormData = require("form-data");

async function upscale(imagePath, scale = 2) {
  try {
    const form = new FormData();
    form.append("file", fs.createReadStream(imagePath));
    const uploadRes = await axios.post("https://get1.imglarger.com/api/UpscalerNew/UploadNew", form, {
      headers: form.getHeaders()
    });
    const code = uploadRes.data.data.code;

    while (true) {
      const body = { code, scaleRadio: scale };
      const res = await axios.post("https://get1.imglarger.com/api/UpscalerNew/CheckStatusNew", body, {
        headers: {
          Accept: "application/json, text/plain, */*",
          "Content-Type": "application/json",
          "User-Agent": "Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Mobile Safari/537.36",
          Referer: "https://imgupscaler.com/"
        }
      });
      const data = res.data.data;
      if (data.status === "success") {
        return { status: true, url: data.downloadUrls[0], filename: data.originalfilename };
      }
      await new Promise(r => setTimeout(r, 3000));
    }
  } catch (e) {
    return { status: false, message: e.message };
  }
}

(async () => {
  const result = await upscale("sample.jpg");
  console.log(result);
})();