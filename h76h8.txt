const axios = require('axios')
const cheerio = require('cheerio')

async function scrapePinterest(url) {
  try {
    const apiUrl = `https://savepinmedia.com/php/api/api.php?url=${encodeURIComponent(url)}`
    const { data } = await axios.get(apiUrl, {
      headers: {
        Accept: '*/*',
        'X-Requested-With': 'XMLHttpRequest'
      }
    })
    const $ = cheerio.load(data)
    const mainImage = $('.load-screenshot').css('background-image')
    const imageUrl = mainImage ? mainImage.replace(/url\(|\)|"|'/g, '') : null
    const authorName = $('.author .info span a').text()
    const authorLink = $('.author .info span a').attr('href')
    const authorPhoto = $('.author .photo img').attr('src')
    const downloadLink = $('.button-download a').attr('href')
    const downloadFile = downloadLink ? `https://savepinmedia.com${downloadLink}` : null
    return {
      imageUrl,
      author: {
        name: authorName,
        link: authorLink,
        photo: authorPhoto
      },
      downloadFile
    }
  } catch (err) {
    console.error('Error scraping Pinterest:', err.message)
    return null
  }
}

scrapePinterest('https://www.pinterest.com/pin/486529566013840625')
  .then(result => console.log(result))
